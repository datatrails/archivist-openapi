{
  "swagger": "2.0",
  "info": {
    "title": "SBOMs API",
    "description": "Simple SBOM repository API.",
    "version": "1.0",
    "contact": {
      "name": "RKVST",
      "url": "https://www.rkvst.com"
    }
  },
  "tags": [
    {
      "name": "SBOMs"
    }
  ],
  "schemes": [
    "https"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/archivist/v1/sboms/-/metadata": {
      "get": {
        "summary": "List SBOM metadata",
        "description": "Returns a list of SBOM metadata.",
        "operationId": "SBOMs_ListMetadata",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/v1ListSBOMsResponse"
            }
          },
          "400": {
            "description": "Returned when the request is badly formed.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "403": {
            "description": "Returned when the user is not authorized to read the SBOM.",
            "schema": {}
          },
          "404": {
            "description": "Returned when the identified SBOM does not exist.",
            "schema": {}
          },
          "500": {
            "description": "Returned when the underlying storage system returns an error.",
            "schema": {}
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "uploaded_before",
            "description": "Only return records for SBOMs uploaded on or before this date.",
            "in": "query",
            "required": false,
            "type": "string",
            "format": "date-time"
          },
          {
            "name": "uploaded_since",
            "description": "Only return records for SBOMs uploaded on or after this date.",
            "in": "query",
            "required": false,
            "type": "string",
            "format": "date-time"
          },
          {
            "name": "trusted",
            "description": "Filter SBOMs based on whether the uploading organisation is verified.",
            "in": "query",
            "required": false,
            "type": "string",
            "enum": [
              "TRUSTEDSTATUS_UNSPECIFIED",
              "TRUSTED",
              "UNTRUSTED"
            ],
            "default": "TRUSTEDSTATUS_UNSPECIFIED"
          },
          {
            "name": "lifecycle_status",
            "description": "Filter SBOMS based on Lifecycle status.",
            "in": "query",
            "required": false,
            "type": "string",
            "enum": [
              "LIFECYCLESTATUS_UNSPECIFIED",
              "ACTIVE",
              "WITHDRAWN"
            ],
            "default": "LIFECYCLESTATUS_UNSPECIFIED"
          },
          {
            "name": "privacy",
            "description": "Filter SBOMs based on Privacy status.",
            "in": "query",
            "required": false,
            "type": "string",
            "enum": [
              "PRIVATESTATUS_UNSPECIFIED",
              "PRIVATE",
              "PUBLIC"
            ],
            "default": "PRIVATESTATUS_UNSPECIFIED"
          },
          {
            "name": "tenant_only",
            "description": "Only return records for SBOMs uploaded by the calling tenant.",
            "in": "query",
            "required": false,
            "type": "boolean"
          },
          {
            "name": "search",
            "description": "Search term to match across all fields in SBOM metadata.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "order_by",
            "description": "Specify sort order for results. For example: 'version desc'.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "page_size",
            "description": "Results list page size. Maximum 50.",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          },
          {
            "name": "page_token",
            "description": "next_page_token returned from a previous list request, if any.",
            "in": "query",
            "required": false,
            "type": "string"
          }
        ],
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms/{uuid}/metadata": {
      "get": {
        "summary": "Get SBOM metadata",
        "description": "Returns the identified SBOM metadata",
        "operationId": "SBOMs_GetMetadata",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/v1SBOMMetadata"
            }
          },
          "400": {
            "description": "Returned when the request is badly formed.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "403": {
            "description": "Returned when the user is not authorized to read the TLS CA certificate.",
            "schema": {}
          },
          "404": {
            "description": "Returned when the identified TLS CA certificate does not exist.",
            "schema": {}
          },
          "500": {
            "description": "Returned when the underlying storage system returns an error.",
            "schema": {}
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms/{uuid}:publish": {
      "post": {
        "summary": "Publishes an SBOM",
        "description": "Publicly publishes an SBOM",
        "operationId": "SBOMs_PublishSBOM",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/v1SBOMMetadata"
            }
          },
          "400": {
            "description": "Returned when the request is badly formed.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "403": {
            "description": "Returned when the user is not authorized to read the SBOM.",
            "schema": {}
          },
          "500": {
            "description": "Returned when the underlying storage system returns an error.",
            "schema": {}
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms/{uuid}:withdraw": {
      "post": {
        "summary": "Withdraws an SBOM",
        "description": "Withdraws an SBOM",
        "operationId": "SBOMs_WithdrawSBOM",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/v1SBOMMetadata"
            }
          },
          "400": {
            "description": "Returned when the request is badly formed.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "403": {
            "description": "Returned when the user is not authorized to read the SBOM.",
            "schema": {}
          },
          "500": {
            "description": "Returned when the underlying storage system returns an error.",
            "schema": {}
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms": {
      "post": {
        "summary": "Upload SBOM.",
        "description": "Uploads an SBOM file.",
        "consumes": [
          "multipart/form-data"
        ],
        "produces": [
          "application/json"
        ],
        "operationId": "SBOMs_Upload",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/v1SBOMMetadata"
            }
          },
          "400": {
            "description": "Returned when the request is badly formed.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "403": {
            "description": "Returned when the user is not authorized to create a blob.",
            "schema": {}
          },
          "429": {
            "description": "Returned when the user blob limit has been reached.",
            "schema": {}
          },
          "500": {
            "description": "Returned when the underlying system returns an error.",
            "schema": {}
          }
        },
        "parameters": [
          {
            "name": "sbom",
            "description": "SBOM file to upload",
            "in": "formData",
            "type": "file",
            "required": true
          },
          {
            "name": "privacy",
            "description": "Privacy of the SBOM to upload. Defaults to PRIVATE.",
            "in": "query",
            "required": false,
            "type": "string",
            "enum": [
              "PRIVATESTATUS_UNSPECIFIED",
              "PRIVATE",
              "PUBLIC"
            ],
            "default": "PRIVATESTATUS_UNSPECIFIED"
          },
          {
            "name": "sbomType",
            "description": "Type of SBOM file being uploaded. Defaults to cyclonedx-xml. Supported Cyclonedx schema versions are 1.3 and 1.4.",
            "in": "query",
            "required": false,
            "type": "string",
            "enum": [
              "cyclonedx-xml",
              "cyclonedx-json",
              "spdx-tag"
            ],
            "default": "cyclonedx-xml"
          },
          {
            "name": "component",
            "description": "Component name for SPDX SBOM.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "version",
            "description": "Version for SPDX SBOM.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "supplier",
            "description": "Supplier of software described by SPDX SBOM.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "hash",
            "description": "Component hash for SPDX SBOM.",
            "in": "query",
            "required": false,
            "type": "string"
          }
        ],
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms/{uuid}": {
      "get": {
        "summary": "Download SBOM.",
        "description": "Downloads an SBOM file.",
        "operationId": "SBOMs_Download",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "type": "file"
            }
          },
          "400": {
            "description": "Returned when the request is badly formed.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "403": {
            "description": "Returned when the user is not authorized to get the blob.",
            "schema": {}
          },
          "500": {
            "description": "Returned when the underlying system returns an error.",
            "schema": {}
          }
        },
        "parameters": [
          {
            "name": "uuid",
            "description": "Specify the SBOMs UUID where `sboms/{uuid}` is the SBOMs Identity e.g. `add30235-1424-4fda-840a-d5ef82c4c96f` from Identity `sboms/add30235-1424-4fda-840a-d5ef82c4c96f`",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms:openapi": {
      "get": {
        "summary": "Get OpenAPI spec for SBOMs",
        "description": "Get OpenAPI v2.0 spec for SBOMs",
        "operationId": "SBOMs_GetOpenAPI",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "429": {
            "description": "Returned when a user exceeds their subscription's rate limit for requests.",
            "schema": {}
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "tags": [
          "SBOMs"
        ]
      }
    },
    "/archivist/v1/sboms:openapi-ui": {
      "get": {
        "summary": "Get OpenAPI UI for SBOMs",
        "description": "Get OpenAPI v2.0 UI for SBOMs",
        "operationId": "SBOMs_GetOpenAPIUI",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {}
          },
          "401": {
            "description": "Returned when the user is not authenticated to the system.",
            "schema": {}
          },
          "429": {
            "description": "Returned when a user exceeds their subscription's rate limit for requests.",
            "schema": {}
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "tags": [
          "SBOMs"
        ]
      }
    }
  },
  "definitions": {
    "ListSBOMsRequestPrivateStatus": {
      "type": "string",
      "enum": [
        "PRIVATESTATUS_UNSPECIFIED",
        "PRIVATE",
        "PUBLIC"
      ],
      "default": "PRIVATESTATUS_UNSPECIFIED"
    },
    "ListSBOMsRequestTrustedStatus": {
      "type": "string",
      "enum": [
        "TRUSTEDSTATUS_UNSPECIFIED",
        "TRUSTED",
        "UNTRUSTED"
      ],
      "default": "TRUSTEDSTATUS_UNSPECIFIED"
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    },
    "v1ListSBOMsRequestLifecycleStatus": {
      "type": "string",
      "enum": [
        "LIFECYCLESTATUS_UNSPECIFIED",
        "ACTIVE",
        "WITHDRAWN"
      ],
      "default": "LIFECYCLESTATUS_UNSPECIFIED"
    },
    "v1ListSBOMsResponse": {
      "type": "object",
      "example": {
        "sboms": [
          {
            "identity": "sboms/01038663-c357-470d-912a-3abc9528dd21",
            "authors": [
              "jitsuin"
            ],
            "supplier": "jitsuin",
            "component": "archivist",
            "version": "5.3.2-stable",
            "hashes": [
              "SHA-1:9209FE5A352860A4920DF6E2597A2413248754463BE35A0A9430F9B9F51C5A52"
            ],
            "uniqueid": "597A2413248754463",
            "upload_date": "2019-08-11 10:06:43",
            "withdrawn_date": null,
            "publish_date": "2020-07-12 12:59:45",
            "trusted": "true",
            "lifecycle_status": "ACTIVE",
            "tenantid": "tenant/c549e53c-c414-451d-a9ac-1d6c11629bd2"
          }
        ],
        "page_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6InN0dW50aWR"
      },
      "properties": {
        "sboms": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/v1SBOMMetadata"
          }
        },
        "next_page_token": {
          "type": "string",
          "description": "Token to retrieve the next page of results or empty if there are none."
        }
      },
      "description": "List of SBOMs (or the next page in a continuing  list request"
    },
    "v1SBOMMetadata": {
      "type": "object",
      "example": {
        "identity": "sboms/01038663-c357-470d-912a-3abc9528dd21",
        "authors": [
          "jitsuin"
        ],
        "supplier": "jitsuin",
        "component": "archivist",
        "version": "5.3.2-stable",
        "hashes": [
          "SHA-1:9209FE5A352860A4920DF6E2597A2413248754463BE35A0A9430F9B9F51C5A52"
        ],
        "uniqueid": "597A2413248754463",
        "upload_date": "2019-08-11 10:06:43",
        "withdrawn_date": null,
        "publish_date": "2020-07-12 12:59:45",
        "trusted": "true",
        "lifecycle_status": "ACTIVE",
        "tenantid": "tenant/c549e53c-c414-451d-a9ac-1d6c11629bd2"
      },
      "properties": {
        "identity": {
          "type": "string",
          "description": "Unique identification for the SBOM, Relative Resource Name."
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "SBOM authors."
        },
        "supplier": {
          "type": "string",
          "description": "Component supplier."
        },
        "component": {
          "type": "string",
          "description": "Component name."
        },
        "version": {
          "type": "string",
          "description": "Component version."
        },
        "hashes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Component hashes."
        },
        "unique_id": {
          "type": "string",
          "description": "Unique Identity for the SBOM.",
          "title": "Unique ID from the SBOM"
        },
        "upload_date": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp for the upload date."
        },
        "uploaded_by": {
          "type": "string",
          "description": "Organisation who uploaded the SBOM."
        },
        "trusted": {
          "type": "boolean",
          "description": "Whether the uploading organisation is verified."
        },
        "lifecycle_status": {
          "$ref": "#/definitions/v1SBOMMetadataLifecycleStatus",
          "description": "Lifecycle status of the SBOM"
        },
        "withdrawn_date": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp that this SBOM was withdrawn, if withdrawn."
        },
        "published_date": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp that this SBOM was published, if published."
        },
        "rkvst_link": {
          "type": "string",
          "description": "Optional link to an SBOM managed as an asset in RKVST."
        },
        "tenantid": {
          "type": "string",
          "description": "Tenant Identity of the owner of the sbom."
        }
      },
      "description": "SBOM Metadata"
    },
    "v1SBOMMetadataLifecycleStatus": {
      "type": "string",
      "enum": [
        "LIFECYCLESTATUS_UNSPECIFIED",
        "ACTIVE",
        "WITHDRAWN"
      ],
      "default": "LIFECYCLESTATUS_UNSPECIFIED"
    }
  }
}
